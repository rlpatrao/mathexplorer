var ge=Math.ceil(15),we=20,re=260,ye=60;var f=0,a=null,c="times",u=null,l=document.getElementById("board"),p=document.getElementById("ball"),B=document.getElementById("table-select"),F=document.getElementById("start-button"),X=document.getElementById("stop-button"),D=document.getElementById("speed-slider"),se=document.getElementById("speed-label"),y=document.getElementById("product-display"),U=document.getElementById("volume-slider"),le=document.getElementById("volume-label"),b=document.getElementById("background-audio"),h=document.getElementById("answer-input"),H=document.getElementById("check-button"),C=document.getElementById("next-question"),O=document.querySelector(".sidebar"),$=document.getElementById("sidebar-toggle"),Y=Array.from(document.querySelectorAll("[data-mode-target]")),x=document.querySelector("main.app > h1"),I=document.querySelector(".hint"),d=document.getElementById("path-overlay");if(!l||!p||!B||!F||!X||!D||!se||!y||!U||!le||!b||!h||!H||!C||!O||!$||Y.length===0||!x||!I||!d)throw new Error("Expected application elements were not found in the DOM.");var k=new Map,W=new Set,oe=new Map,_=null,g=null;function j(){d&&(d.innerHTML="",g=null)}function L(e=c==="times"){W.forEach(t=>{t.classList.remove("visited"),t.classList.remove("active")}),W.clear(),a=null,e&&J(),j()}function Me(){let e=Math.floor(Math.random()*360);return{runColor:`hsla(${e}, 85%, 68%, 0.95)`,runShadow:`hsla(${e}, 80%, 35%, 0.35)`,runShadowStrong:`hsla(${e}, 82%, 32%, 0.45)`,ballLight:`hsla(${e}, 95%, 88%, 0.85)`,ballBorder:`hsla(${e}, 85%, 65%, 0.6)`,ballGlow:`hsla(${e}, 85%, 52%, 0.4)`}}function Ee(e){l.style.setProperty("--run-color",e.runColor),l.style.setProperty("--run-color-shadow",e.runShadow),l.style.setProperty("--run-color-shadow-strong",e.runShadowStrong),l.style.setProperty("--ball-color-light",e.ballLight),l.style.setProperty("--ball-border-color",e.ballBorder),l.style.setProperty("--ball-glow",e.ballGlow)}function Le(e){var n;let t=(n=oe.get(e))!=null?n:null;return t||(t=Me(),oe.set(e,t)),Ee(t),t}function N(){b.pause(),b.currentTime=0}async function ae(){b.pause(),b.currentTime=0,b.load(),ce();try{await b.play()}catch(e){console.warn("Background audio play request was blocked or failed:",e),ue()}}function ue(){if(_)return;let e=()=>{b.play().catch(t=>{console.warn("Retrying background audio play failed:",t),ue()}),document.removeEventListener("pointerup",e),document.removeEventListener("keydown",e),document.removeEventListener("touchend",e),_=null};_=e,document.addEventListener("pointerup",e,{once:!0,passive:!0}),document.addEventListener("touchend",e,{once:!0,passive:!0}),document.addEventListener("keydown",e,{once:!0})}function ce(){let e=z(),t=Math.pow(e,.8),n=e<=.01?0:.15+t*.75;b.volume=Math.max(0,Math.min(1,n))}function z(){let e=Number(U.value);return Number.isFinite(e)?Math.max(0,Math.min(1,e/100)):ye/100}function A(e,t){return Math.floor(Math.random()*(t-e+1))+e}function Te(e){if(e==="addition")for(;;){let t=A(1,99),n=A(1,99),o=t+n;if(o<=150)return{mode:e,a:t,b:n,answer:o,symbol:"+"}}for(;;){let t=A(10,99),n=A(1,t-1),o=t-n;if(o>=1)return{mode:e,a:t,b:n,answer:o,symbol:"\u2212"}}}function Se(e){y.textContent=`${e.a} ${e.symbol} ${e.b} = ?`}function Ae(e,t){let n=`${e.a} ${e.symbol} ${e.b} = ${e.answer}`;y.textContent=`${t?"\u2705":"\u274C"} ${n}`}function J(){y.textContent=""}function de(e){switch(Y.forEach(t=>{t.classList.toggle("active",t.dataset.modeTarget===e)}),e){case"addition":x.textContent="Addition Trainer",I.textContent="Answer the question, then watch the tens and ones hops bring the sum to life.";break;case"subtraction":x.textContent="Subtraction Trainer",I.textContent="Work backwards with tens and ones hops to see the difference unfold.";break;default:x.textContent="Times Table Explorer",I.textContent="Select a number to watch its multiples up to 150. Adjust the hop speed to suit your pace."}}function $e(e,t,n){y.textContent=`${e} x ${t} = ${n}`}function xe(){let e=new Set;Array.from(B.options).forEach(t=>{e.add(t.value)});for(let t=1;t<=we;t+=1)if(!e.has(String(t))){let n=document.createElement("option");n.value=String(t),n.textContent=String(t),B.append(n)}}function Ie(){l.innerHTML="",k.clear(),L(),l.style.setProperty("--grid-columns",String(ge)),l.style.setProperty("--grid-rows",String(10));let e=document.createDocumentFragment();for(let t=1;t<=150;t+=1){let n=document.createElement("div");n.className="cell",n.dataset.value=String(t),n.textContent=String(t),e.append(n),k.set(t,n)}l.append(e),d&&l.append(d),l.append(p)}function me(){let t=(Number(D.value)/1e3).toFixed(1);se.textContent=`${t}s`}function E(){return Number(D.value)}function pe(){let e=Math.round(z()*100);le.textContent=`${e}%`,ce()}function Q(e){F.disabled=e,X.disabled=!e}function P(e){if(a&&a!==e&&a.classList.remove("active"),!e){a=null,c==="times"&&J();return}a=e,a.classList.add("visited"),a.classList.add("active"),W.add(a)}function he(e,t,n){if(!d||!e)return;let o=l.getBoundingClientRect(),i=e.getBoundingClientRect(),r=t.getBoundingClientRect(),s=i.left-o.left+i.width/2,m=i.top-o.top+i.height/2,w=r.left-o.left+r.width/2,T=r.top-o.top+r.height/2,q=(s+w)/2,be=Math.max(30,Math.abs(w-s)*.35),ee=Math.min(m,T)-be;g==null||g.classList.remove("current"),g==null||g.classList.add("past");let te=l.clientWidth,ne=l.clientHeight;d.setAttribute("viewBox",`0 0 ${te} ${ne}`),d.setAttribute("width",String(te)),d.setAttribute("height",String(ne));let S=document.createElementNS("http://www.w3.org/2000/svg","g");S.classList.add("hop-path","current");let G=document.createElementNS("http://www.w3.org/2000/svg","path");G.setAttribute("class","path-curve"),G.setAttribute("d",`M ${s} ${m} Q ${q} ${ee} ${w} ${T}`);let M=document.createElementNS("http://www.w3.org/2000/svg","text");M.setAttribute("class","path-label"),M.setAttribute("x",String(q)),M.setAttribute("y",String(ee-6)),M.textContent=n,S.append(G,M),d.append(S),g=S;let V=Array.from(d.querySelectorAll(".hop-path.past"));V.length>3&&V.slice(0,V.length-3).forEach(ve=>ve.remove())}function v(e,t=!0){if(!e){p.classList.remove("visible");return}let n=t?E():0;p.style.setProperty("--hop-duration",`${n}ms`);let o=e.offsetWidth,i=e.offsetHeight;p.style.width=`${o}px`,p.style.height=`${i}px`;let r=e.offsetLeft,s=e.offsetTop;p.classList.add("visible"),p.style.transform=`translate3d(${r}px, ${s}px, 0)`,t||requestAnimationFrame(()=>{p.style.setProperty("--hop-duration",`${E()}ms`)})}function K(e,t=.95){if(!("speechSynthesis"in window))return;let n=new SpeechSynthesisUtterance(e);n.lang="en-US",n.rate=t,n.pitch=1.05,n.volume=Math.max(0,Math.min(1,z())),window.speechSynthesis.cancel(),window.speechSynthesis.speak(n)}function Be(e,t,n){let o=E()<1500,i=o?`${n}`:`${e} times ${t} is ${n}`;K(i,o?1.05:.95)}function He(e){let t=[];for(let n=1;n<=12;n+=1){let o=e*n;if(o>150)break;t.push({multiplier:n,product:o})}return t}function Ce(e){let t=[],n=e.a;t.push(n);let o=Math.floor(e.b/10),i=e.b%10,r=e.mode==="addition"?1:-1;for(let s=0;s<o;s+=1)n+=r*10,t.push(n);for(let s=0;s<i;s+=1)n+=r,t.push(n);return t[t.length-1]!==e.answer&&t.push(e.answer),t}function ke(e){return e>0?`+${e}`:e<0?`${e}`:"0"}function Pe(e,t){let n=t-e.a;return e.mode==="subtraction"?n===0?"0":`${n}`:n>=0?`+${n}`:`${n}`}function R(e){return new Promise(t=>{window.setTimeout(t,e)})}async function Re(e,t){var r;let n=Ce(e);L(!1),v(null),await R(150);let o=null,i=null;for(let s of n){if(t!==f)return;let m=(r=k.get(s))!=null?r:null;if(m){if(i=a,P(m),v(m),i&&o!==null){let w=Pe(e,s);he(i,m,w)}o=s,await R(E()+re)}}t===f&&c!=="times"&&N()}function Z(e){var t,n;Q(!1),N(),P(null),j(),e&&(p.classList.remove("visible"),(n=(t=window.speechSynthesis)==null?void 0:t.cancel)==null||n.call(t))}async function De(e,t){var i;let n=He(e);P(null),v(null),await R(150);let o=null;for(let r of n){if(t!==f)return;let s=(i=k.get(r.product))!=null?i:null;if(!s)continue;let m=a;if(P(s),$e(e,r.multiplier,r.product),v(s),Be(e,r.multiplier,r.product),m&&o!==null){let T=r.product-o;he(m,s,ke(T))}o=r.product;let w=E()+re;await R(w)}t===f&&Z(!1)}function fe(){if(c==="times"){u=null;return}u=Te(c),L(!1),v(null),Se(u),h.value="",K(`${u.a} ${u.mode==="addition"?"plus":"minus"} ${u.b}. What is the answer?`,.95)}function Ne(e){var n,o;if(c===e)return;f+=1,N(),(o=(n=window.speechSynthesis)==null?void 0:n.cancel)==null||o.call(n),Q(!1),c=e,document.body.dataset.mode=e,de(e),L(),v(null);let t=e!=="times";h.disabled=!t,H.disabled=!t,C.disabled=!t,t?(fe(),h.focus()):(u=null,J(),h.value="")}function Qe(){c!=="times"&&(N(),fe(),h.focus())}function ie(){if(c==="times"||!u)return;let e=h.value.trim();if(!e){y.textContent="Enter an answer to check";return}let t=Number(e);if(!Number.isFinite(t)){y.textContent="Please enter a number";return}let n=t===u.answer;Ae(u,n);let o=`${u.a} ${u.mode==="addition"?"plus":"minus"} ${u.b} equals ${u.answer}`;K(o,n?.95:.9),f+=1;let i=f;ae(),Re(u,i),window.setTimeout(()=>{h.focus()},10)}function Ge(){var n,o;if(c!=="times")return;let e=Number(B.value);if(!Number.isFinite(e)||e<1)return;L(),v(null),Le(e),ae(),f+=1;let t=f;Q(!0),(o=(n=window.speechSynthesis)==null?void 0:n.cancel)==null||o.call(n),De(e,t).catch(i=>{console.error(i),Z(!0)})}function Ve(){f+=1,Z(!0)}function _e(){me(),a&&v(a,!1)}function Oe(){pe()}function We(){j(),a&&v(a,!1)}function Fe(){document.body.dataset.mode=c,de(c),h.disabled=!0,H.disabled=!0,C.disabled=!0,xe(),Ie(),me(),pe(),Q(!1),Y.forEach(n=>{n.addEventListener("click",()=>{let o=n.dataset.modeTarget;Ne(o)})}),F.addEventListener("click",Ge),X.addEventListener("click",Ve),D.addEventListener("input",_e),U.addEventListener("input",Oe),window.addEventListener("resize",We),H.addEventListener("click",ie),C.addEventListener("click",Qe),h.addEventListener("keydown",n=>{n.key==="Enter"&&(n.preventDefault(),ie())}),$.addEventListener("click",()=>{let n=O.classList.toggle("collapsed");$.setAttribute("aria-expanded",(!n).toString())});let e=window.matchMedia("(max-width: 640px)"),t=()=>{e.matches&&(O.classList.add("collapsed"),$.setAttribute("aria-expanded","false"))};t(),typeof e.addEventListener=="function"?e.addEventListener("change",t):typeof e.addListener=="function"&&e.addListener(t)}Fe();"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").catch(e=>console.error("Service worker registration failed:",e))});
//# sourceMappingURL=main.js.map
